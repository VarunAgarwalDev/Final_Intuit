<!DOCTYPE HTML>

<html>
<head>
  <link rel="stylesheet" type="text/css" href="stylesheet.css">
  <link href='http://fonts.googleapis.com/css?family=Roboto:100' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/bootstrap.css" rel="stylesheet">
  <link href="carousel.css" rel="stylesheet">
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.2.19.min.js"></script>
  
  <link href='http://fonts.googleapis.com/css?family=Oswald:400,300|Roboto:400,300' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Raleway:400,300' rel='stylesheet' type='text/css'>
  <link rel = 'stylesheet' type = 'text/css' href = 'stylesheet.css'>
  


</head>
<title>Viva La Sleep prototype</title>


<body>
  <h1>Viva la Sleep</h1>
  <h2>Get work done. Sleep on time.</h2>
  <body background="gaussianblur.jpg">

    <div id="lower_body">

      <div class="meter">
        <span style="width: 25%"></span>
      </div>
      <div id='cssmenu'>
        <ul>
         <li class='active'><a href='#'><span>About Us</span></a></li>
         <li class='has-sub'><a href='CircleProgressBar/backupprogressbar.html'><span>Progress</span></a>
          <li><a href='assignment.html'><span>Assignments</span></a>
            <li class='active'><a href='landingpage.html'><span>Sign Out</span></a></li>
          </ul>
        </div>

        <!-- Adding an assignment -->
        <div class="addAssignment">
          <h3 style="text-align:center; color:white"> Add new assignments below </h3>
          <script type = 'text/javascript'>
          function changeThis() {
            var assignmentInput = document.getElementById('assignment');
            document.getElementById('newAssign').innerHTML = assignmentInput.value;
            var minsInput = document.getElementById('mins');
            document.getElementById('newMins').innerHTML = minsInput.value;
          }
          </script>
          <script type="text/javascript" src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
          <script type="text/javascript">
          $(document).ready(function () {
            $('<div/>', {
              'class' : 'extraPerson', html: GetHtml()
            }).appendTo('#container');
            $('#addRow').click(function () {
              $('<div/>', {
                'class' : 'extraPerson', html: GetHtml()
              }).hide().appendTo('#container').slideDown('slow');

            });
          })

          function GetHtml()
          {
            //var len = $('.extraPerson').length;
            //var $html = $('.extraPersonTemplate').clone();
            //$html.find('[name=assignment]')[0].name="assignment" + len;
            //$html.find('[name=mins]')[0].name="mins" + len;
            //return $html.html();    
          }
          </script>

          <div class="extraPersonTemplate">
            <div class="controls controls-row">
              <label>
                <input id="assignment" class="span3" placeholder="Assignment" type="text" name="assignment">
                <input id="mins" class="span2" placeholder="Enter minutes" type="text" name="mins">
                <input id="addNewAssignment" class="submit" type="submit" value="Submit">
              </select>
            </label>
          </div>
        </div> 
        <div id="container"></div>
        <!--<a class = 'addRow' href="#" id="addRow"><i class="icon-plus-sign icon-white"></i>Add more</p></a-->
      </div>

      <!-- Display added assignments -->
      <h3 style="text-align:center; color:white"> View assignments for today here </h3>
      <ul id="assignments" class="list-group">
        <!-- here the  assignments will be inserted -->
        <!--li class="list-group-item list-group-item-danger" style="text-align:center">Assignment 4</li-->
      </ul>
      <table class="table table-striped" table align = "center">
        <thead>
          <tr style="color:white">
            <th >Assignment Name</th>
            <th>Time (in Minutes)</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="assignmentList">

        </tbody>

      </table>

      <script type="text/javascript">
                Parse.initialize("LcQYRvseB9ExXGIherTt1v2pw2MVzPFwVXfigo11", "F5enB5XfOfqo4ReAItZCkJVxOY76hoveZrOMwih9");

      $("#addNewAssignment").on('click', function(){

        var username = getUsername();
        var assignment = $("#assignment").val();
        var time = parseInt($("#mins").val());
        createNewAssignment( assignment, username, time);

      });



//  making the list of assignment in the ui from the assignments pulled from the database
var makeAssignmentList = function(username){
  var query = new Parse.Query("Assignment");
  query.equalTo("username", username);
  query.find({
    success: function(results){


      for(var i = 1; i < results.length; i++ ){
        console.log(results[i].get("assignment"));
        var assignmentList = $("#assignmentList");

        var tr = $('<tr></tr>');
        var td = $('<td></td>').text(results[i].get("assignment"));
        var td2 = $('<td></td>').text(results[i].get("time"));

        var btn = '<td><button class="done-button" type="button"> Done</button></td>'
            //add to the bottom of the list
            $(tr).append(td);
            $(tr).append(td2);
            $(tr).append(btn);

            assignmentList.append(tr);
          }

        },
        error: function( assignment,error) {
            // Show the error message somewhere and let the user try again.
            alert("Error: " + error.code + " " + error.message);

          }
        });
};


  //Function for creating a new assignment and adding to the database
  var createNewAssignment = function (assignmentName, username, time){
    var Assignment = Parse.Object.extend("Assignment");

    //Creating a new instance of the class
    var assignment = new Assignment();
    
    var _assignmentName = assignmentName;
    var _time = time;
    var assignment_data = {assignment: _assignmentName, username: username, time: _time, completed: 0};

    /* Save the Assignment */

    assignment.save(assignment_data, 
      {success: function(assignment) {
            // Hooray! Let them use the app now.
            var assignmentList = $("#assignmentList");
            var tr = $('<tr></tr>');
            var td = $('<td></td>').text(assignment.get("assignment"));
            var td2 = $('<td></td>').text(assignment.get("time"));

            var btn = '<td><button class="done-button" type="button"> Done</button></td>'
            //add to the bottom of the list
            $(tr).append(td);
            $(tr).append(td2);
            $(tr).append(btn);
            assignmentList.append(tr);
          },
          error: function( assignment,error) {
            // Show the error message somewhere and let the user try again.
            alert("Error: " + error.code + " " + error.message);

          }
        });
      //things to do after the save takes place
    };

    var getUsername = function (){
      var half = (document.cookie).substring(9);
      var array = (half).split(";");
      var username = array[0];
      return username;
    };


    var username = getUsername();
    makeAssignmentList(username);

      var done= document.getElementById('done-button');
      console.log(done);

      $(".done-button").click(function(){
        alert(clicked);
      });

/*
      $(".done-button").on('click', function(){
          alert("done clicked");
          //var parent = this.parent.append("<span>Completed</span>")
          //this.fadeOut();
        });
      });*/
     $(document).on('click', "button.done-button", function() {


        var assignmentName = $(this).parent().parent().children(":first").html();
        console.log(assignmentName);

        //replace the button with text that says "completed"
        var parent = $(this).parent().append("<span style='color:green'>Completed</span>")
        $(this).fadeOut();   

        //in the database change completed status to 1
        var query = new Parse.Query("Assignment");
        query.equalTo("assignment", assignmentName);
        query.first({
         success: function(assignment){
            console.log(assignment);
          //updating the completed column for this assingment
            assignment.save({completed:1}, {
              success: function() {
                console.log("assginment has been updated with completed=1");
              }
          });
        },
        error: function( assignment,error) {
              // Show the error message somewhere and let the user try again.
              alert("Error: " + error.code + " " + error.message);

          }
        });
    });


    var getCompletedAssignments = function(){
      var Assignment = Parse.Object.extend("Assignment");
      var query = new Parse.Query(Assignment);
      query.equalTo("completed", 1);
      query.equalTo("username", getUsername());
      query.find({
        success: function(results) {
          console.log("no of completed assignments");
          console.log(results.length);
        },
        error: function(error) {
          alert("Error: " + error.code + " " + error.message);
        }
      });
    };
    getCompletedAssignments();

    </script>

  </body>



  </html>
